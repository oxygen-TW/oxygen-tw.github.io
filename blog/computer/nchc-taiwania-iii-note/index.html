<!DOCTYPE html>
<html lang="zh-tw" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>國網中心台灣杉三號使用筆記 - 氧氣橘子</title>
  


<script data-ad-client="ca-pub-1261313044129512" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="oxygen" />
  <meta name="description" content="最近在使用國網中心台灣杉三號上花了點時間研究跟嘗試才成功送出訓練任務，雖然國網的說明已經有寫到大部份資訊了，但相對比較分散而且有些小細節沒有提到，我便整理一下寫成筆記免得自己以後忘記，也順便分享給大家，希望大家少遇到一些問題XD
" />







<meta name="generator" content="Hugo 0.148.0" />


<link rel="canonical" href="https://oxygentw.net/blog/computer/nchc-taiwania-iii-note/" />





<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.2d2189efee6cec3ea8e6d6a81b2cfbca060635e152dca5d5ce35bfb8b4226ead.css" integrity="" media="screen" crossorigin="anonymous">





<meta property="og:url" content="https://oxygentw.net/blog/computer/nchc-taiwania-iii-note/">
  <meta property="og:site_name" content="氧氣橘子">
  <meta property="og:title" content="國網中心台灣杉三號使用筆記">
  <meta property="og:description" content="最近在使用國網中心台灣杉三號上花了點時間研究跟嘗試才成功送出訓練任務，雖然國網的說明已經有寫到大部份資訊了，但相對比較分散而且有些小細節沒有提到，我便整理一下寫成筆記免得自己以後忘記，也順便分享給大家，希望大家少遇到一些問題XD">
  <meta property="og:locale" content="zh_tw">
  <meta property="og:type" content="article">
    <meta property="article:section" content="blog">
    <meta property="article:published_time" content="2023-11-19T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-07-11T00:00:00+00:00">

  <meta itemprop="name" content="國網中心台灣杉三號使用筆記">
  <meta itemprop="description" content="最近在使用國網中心台灣杉三號上花了點時間研究跟嘗試才成功送出訓練任務，雖然國網的說明已經有寫到大部份資訊了，但相對比較分散而且有些小細節沒有提到，我便整理一下寫成筆記免得自己以後忘記，也順便分享給大家，希望大家少遇到一些問題XD">
  <meta itemprop="datePublished" content="2023-11-19T00:00:00+00:00">
  <meta itemprop="dateModified" content="2025-07-11T00:00:00+00:00">
  <meta itemprop="wordCount" content="2380">
  <meta itemprop="keywords" content="Oxygen">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="國網中心台灣杉三號使用筆記">
  <meta name="twitter:description" content="最近在使用國網中心台灣杉三號上花了點時間研究跟嘗試才成功送出訓練任務，雖然國網的說明已經有寫到大部份資訊了，但相對比較分散而且有些小細節沒有提到，我便整理一下寫成筆記免得自己以後忘記，也順便分享給大家，希望大家少遇到一些問題XD">

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->


      <script async src="https://www.googletagmanager.com/gtag/js?id=4942793011"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', '4942793011');
        }
      </script>


</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">O<sub>2</sub>range</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://oxygentw.net/">Home</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://oxygentw.net/blog/">Archives</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://oxygentw.net/categories/">Categories</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://oxygentw.net/tags/">Tags</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://oxygentw.net/about/">About</a>
          
        
      </li>
    

    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      O<sub>2</sub>range
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://oxygentw.net/">Home</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://oxygentw.net/blog/">Archives</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://oxygentw.net/categories/">Categories</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://oxygentw.net/tags/">Tags</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://oxygentw.net/about/">About</a>
          

        

      </li>
    

    
    

    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">國網中心台灣杉三號使用筆記</h1>
      
      <div class="post-meta">
        <time datetime="2023-11-19" class="post-time">
          2023-11-19
        </time>
        <div class="post-category">
            
          </div>
        <span class="more-meta"> 約 2380 字 </span>
          <span class="more-meta"> 預計閱讀 5 分鐘 </span>

        
        

        
        
      </div>
    </header>

    
    

    
    <div class="post-content">
      <p>最近在使用國網中心台灣杉三號上花了點時間研究跟嘗試才成功送出訓練任務，雖然國網的說明已經有寫到大部份資訊了，但相對比較分散而且有些小細節沒有提到，我便整理一下寫成筆記免得自己以後忘記，也順便分享給大家，希望大家少遇到一些問題XD</p>
<p>此筆記情境為使用台灣杉三號生醫專用節點進行影像分類的訓練任務，以 Python 為程式語言，Pytorch 為深度學習套件，過程中需要調用 GPU 資源。</p>
<h2 id="1-登入">1. 登入</h2>
<p>如同一般的登入方式，使用ssh連線至台灣杉三號生醫專用節點，並輸入帳號密碼。 <br>
生醫專用節點主機位置：<a href="twnia3.nchc.org.tw">twnia3.nchc.org.tw</a></p>
<p>比較特別的是台灣杉三號多了一層 MOTP 驗證，<del>MOTP可以在<a href="https://iservice.nchc.org.tw/nchc_service/index.php?lang_type=">計算資源服務網</a>中：會員中心&gt;會員資訊&gt;主機帳號資訊&gt;OTP 認證碼中找到。</del></p>
<p>2025更新：現在國網的 OTP 改用 IDExpert 了，可參考以下網址進行設定 <a href="https://man.twcc.ai/@TWCC-III-manual/SJwbCxzqO">https://man.twcc.ai/@TWCC-III-manual/SJwbCxzqO</a></p>
<h2 id="2-載入-conda-環境">2. 載入 Conda 環境</h2>
<p>台灣杉三號中有預載許多常用的環境，可以使用 <code>module avail</code> 查看。</p>
<p>其中也包含 miniconda3，我們可以使用 <code>module load miniconda3</code> 或 <code>ml miniconda3</code> 指令載入 miniconda3 環境，載入後使用方式就與一般conda相同。</p>
<h2 id="3-gpu-環境--pytorch-安裝">3. GPU 環境 / Pytorch 安裝</h2>
<p>在 Conda 環境中安裝套件就和平常的操作方式一樣，比較不同的是 Pytorch，因為台灣杉三號的 CUDA 版本較舊，如果直接安裝最新版會導致 Pytorch 找不到 GPU，因此我們要先使用 <code>nvidia-smi</code> 指令查看 CUDA 版本。</p>

<link rel="stylesheet" href="/css/hugo-easy-gallery.css" />
<div class="box">
<figure  itemprop="associatedMedia"
  itemscope itemtype="http://schema.org/ImageObject" 
  style="max-width:800px" >
    <div class="img">
      <img itemprop="thumbnail" src="/img/post/nchc-taiwania-iii-note/nvidia.jpg" />
    </div>
    <a href="/img/post/nchc-taiwania-iii-note/nvidia.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

<p>截至今日(2023/11/19)，CUDA版本為 11.0，因此我們要到 <a href="https://pytorch.org/get-started/previous-versions/">Pytorch 網站</a> 找適用 CUDA 小於 11.0 的版本安裝，到目前適合的安裝指令為:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># CUDA 10.2</span>
</span></span><span class="line"><span class="cl">conda install <span class="nv">pytorch</span><span class="o">==</span>1.12.1 <span class="nv">torchvision</span><span class="o">==</span>0.13.1 <span class="nv">torchaudio</span><span class="o">==</span>0.12.1 <span class="nv">cudatoolkit</span><span class="o">=</span>10.2 -c pytorch</span></span></code></pre></td></tr></table>
</div>
</div>
<p>另外，透過這樣的環境安裝方式不需要去考慮 cuDNN 的問題，他會自動處理好。</p>
<p>安裝好後可以用下列指令測試是否成功安裝並且 Pytorch 可以順利使用 GPU。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1">#應回應 True</span>
</span></span><span class="line"><span class="cl">python -c <span class="s2">&#34;import torch; print(torch.cuda.is_available())&#34;</span></span></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="4-其餘套件安裝">4. 其餘套件安裝</h2>
<p>到此我們應該已經順利安裝好 Pytorch 並設定好 GPU 了，我列出一些在影像處理與深度學習常用的套件安裝指令。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">conda install -c conda-forge seaborn <span class="c1">#DO NOT USE 0.12.*. IT HAS A BUG IN HEATMAP</span>
</span></span><span class="line"><span class="cl">conda install -c anaconda scikit-learn pillow pandas
</span></span><span class="line"><span class="cl">conda install -c conda-forge matplotlib
</span></span><span class="line"><span class="cl">conda install scikit-learn-intelex
</span></span><span class="line"><span class="cl">conda install -c conda-forge tqdm
</span></span><span class="line"><span class="cl">conda install -c conda-forge opencv</span></span></code></pre></td></tr></table>
</div>
</div>
<p>安裝完後環境設定就完成了!</p>
<h2 id="5-儲存空間">5. 儲存空間</h2>
<p>根據國網中心的說明文件，我們有這些地方可以儲存我們的資料，一般建議執行檔相關或環境檔案才儲存於 <code>/home/$USER</code>，其餘 Data 儲存在有10TB額度的 <code>/staging/biology/$USER</code>。</p>
<table>
  <thead>
      <tr>
          <th>空間</th>
          <th>容量</th>
          <th>刪除期限</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>/home/$USER</td>
          <td>100G</td>
          <td>無</td>
      </tr>
      <tr>
          <td><strong>/staging/biology/$USER</strong></td>
          <td>10T</td>
          <td>無</td>
      </tr>
      <tr>
          <td>/work/$USER</td>
          <td>1500GB</td>
          <td>一個月不動檔案刪除</td>
      </tr>
      <tr>
          <td>/staging/reserve/PI_folder</td>
          <td>付費空間需另外申請</td>
          <td>無</td>
      </tr>
      <tr>
          <td>巨量資料儲存服務</td>
          <td>付費空間需另外申請</td>
          <td>無</td>
      </tr>
  </tbody>
</table>
<h2 id="6-提交任務">6. 提交任務</h2>
<p>台灣杉三號屬於高速運算資源，也就是俗稱的超級電腦，使用 <a href="https://zh.wikipedia.org/zh-tw/Slurm%E5%B7%A5%E4%BD%9C%E8%B0%83%E5%BA%A6%E5%B7%A5%E5%85%B7">slurm</a> 作為資源管理工具管理資源的分配，簡單來說就是當你要執行運算時，你得先向 slurm 提交你的運算要求，等 slurm 將資源分配給你進行運算。</p>
<blockquote>
<p>千萬不要在登入節點直接進行運算作業</p></blockquote>
<p>slurm 常用的指令有:</p>
<ul>
<li><code>sbatch job.sh</code>：將 job.sh 提交給 slurm 申請資源，他會回應一串 job id。</li>
<li><code>scancel $job_id</code>：中止特定任務。</li>
<li><code>scontrol show jib $job_id</code>：顯示特定任務狀態。</li>
</ul>
<p>比較要注意的是我們必須在 <code>job.sh</code> 中定義一些 slurm 的設定(你也可以在命令列用參數輸入，但偏麻煩我就不介紹了) 我直接參考國網中心的說明文件範例。</p>
<h4 id="jobsh-cpu-任務">job.sh CPU 任務</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="cp">#!/usr/bin/sh
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="c1">#SBATCH -A MST109178        # project number</span>
</span></span><span class="line"><span class="cl"><span class="c1">#SBATCH -J Job_name         # Job name</span>
</span></span><span class="line"><span class="cl"><span class="c1">#SBATCH -p ngs53G           # Partition Name 等同PBS裡面的 -q Queue name</span>
</span></span><span class="line"><span class="cl"><span class="c1">#SBATCH -c 8                # 使用的core數 請參考Queue資源設定 </span>
</span></span><span class="line"><span class="cl"><span class="c1">#SBATCH --mem=53g           # 使用的記憶體量 請參考Queue資源設定</span>
</span></span><span class="line"><span class="cl"><span class="c1">#SBATCH -o out.log          # Path to the standard output file </span>
</span></span><span class="line"><span class="cl"><span class="c1">#SBATCH -e err.log          # Path to the standard error ouput file</span>
</span></span><span class="line"><span class="cl"><span class="c1">#SBATCH --mail-user=XXXX@narlabs.org.tw    # email</span>
</span></span><span class="line"><span class="cl"><span class="c1">#SBATCH --mail-type=BEGIN,END              # 指定送出email時機 可為NONE, BEGIN, END, FAIL, REQUEUE, ALL</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s1">&#39;Hello world!&#39;</span>  <span class="c1">##這邊寫入你要執行的指令</span></span></span></code></pre></td></tr></table>
</div>
</div>
<p>裡面的 Partition Name 請參考說明中 <a href="https://man.twcc.ai/@Ldk_QYrOR2yo3m8Cb1549A/rkegDKslF#PartitionQueue-%E8%B3%87%E6%BA%90%E8%A8%AD%E5%AE%9A">Partition(Queue) 資源設定</a> 表格，依自己所需要的運算資源選擇，其中 Partition Name, memory size, core number，需要和表格中的一樣，如果設定錯誤的話會無法執行任務。</p>
<p>例如表格中</p>
<table>
  <thead>
      <tr>
          <th>Partition</th>
          <th>記憶體配置(&ndash;mem)</th>
          <th>核心數搭配(-c)</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>ngs7G</td>
          <td>7G</td>
          <td>1</td>
      </tr>
  </tbody>
</table>
<p>我們在設定檔中就應該要設定為：
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1">#SBATCH -p ngs7G   </span>
</span></span><span class="line"><span class="cl"><span class="c1">#SBATCH -c 1            </span>
</span></span><span class="line"><span class="cl"><span class="c1">#SBATCH --mem=7g     </span></span></span></code></pre></td></tr></table>
</div>
</div></p>
<hr>
<p>GPU 任務的設定方式類似，只是多了一行GPU核心數的設定，一樣用國網中心說明文件的範例說明：</p>
<h4 id="jobsh-gpu-任務">job.sh GPU 任務</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="cp">#!/usr/bin/sh
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="c1">#SBATCH -A MST109178        # Account name/project number</span>
</span></span><span class="line"><span class="cl"><span class="c1">#SBATCH -J Job_name         # Job name</span>
</span></span><span class="line"><span class="cl"><span class="c1">#SBATCH -p ngs1gpu           # Partition Name 等同PBS裡面的 -q Queue name</span>
</span></span><span class="line"><span class="cl"><span class="c1">#SBATCH -c 6               # 使用的core數  請參考Queue資源設定 </span>
</span></span><span class="line"><span class="cl"><span class="c1">#SBATCH --mem=90g           # 使用的記憶體量 請參考Queue資源設定</span>
</span></span><span class="line"><span class="cl"><span class="c1">#SBATCH --gres=gpu:1        # 使用的GPU數 請參考Queue資源設定</span>
</span></span><span class="line"><span class="cl"><span class="c1">#SBATCH -o out.log          # Path to the standard output file </span>
</span></span><span class="line"><span class="cl"><span class="c1">#SBATCH -e err.log          # Path to the standard error ouput file</span>
</span></span><span class="line"><span class="cl"><span class="c1">#SBATCH --mail-user=XXXX@narlabs.org.tw    # email</span>
</span></span><span class="line"><span class="cl"><span class="c1">#SBATCH --mail-type=BEGIN,END              # 指定送出email時機 可為NONE, BEGIN, END, FAIL, REQUEUE, ALL</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">nvidia-smi  <span class="c1">##這邊寫入你要執行的指令</span></span></span></code></pre></td></tr></table>
</div>
</div>
<p>主要就是多了 <code>#SBATCH --gres=gpu:1</code> 這行而已。 <br>
其他相關設定如 log file path、email 通知等等就看後面註解的說明。</p>
<h2 id="7-實際執行">7. 實際執行</h2>
<p>到這一步我們應該可以順利撰寫 script file 並提交給 slrum 執行了，完整的 job.sh 範例如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="cp">#!/usr/bin/sh
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="c1">#SBATCH -A MST109178        # Account name/project number</span>
</span></span><span class="line"><span class="cl"><span class="c1">#SBATCH -J Job_name         # Job name</span>
</span></span><span class="line"><span class="cl"><span class="c1">#SBATCH -p ngs1gpu           # Partition Name 等同PBS裡面的 -q Queue name</span>
</span></span><span class="line"><span class="cl"><span class="c1">#SBATCH -c 6               # 使用的core數  請參考Queue資源設定 </span>
</span></span><span class="line"><span class="cl"><span class="c1">#SBATCH --mem=90g           # 使用的記憶體量 請參考Queue資源設定</span>
</span></span><span class="line"><span class="cl"><span class="c1">#SBATCH --gres=gpu:1        # 使用的GPU數 請參考Queue資源設定</span>
</span></span><span class="line"><span class="cl"><span class="c1">#SBATCH -o out.log          # Path to the standard output file </span>
</span></span><span class="line"><span class="cl"><span class="c1">#SBATCH -e err.log          # Path to the standard error ouput file</span>
</span></span><span class="line"><span class="cl"><span class="c1">#SBATCH --mail-user=XXXX@narlabs.org.tw    # email</span>
</span></span><span class="line"><span class="cl"><span class="c1">#SBATCH --mail-type=BEGIN,END              # 指定送出email時機 可為NONE, BEGIN, END, FAIL, REQUEUE, ALL</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">module purge
</span></span><span class="line"><span class="cl">ml miniconda3
</span></span><span class="line"><span class="cl">conda activate myenv <span class="c1">#進入 conda 環境</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">python -u /path/to/script.py</span></span></code></pre></td></tr></table>
</div>
</div>
<p>以上有一個重點!! python 後面要加上 <code>-u</code>，這個參數的意思是強迫 STDOUT、STDERR 不要使用 buffer(force the stdout and stderr streams to be unbuffered)，如果不這樣做的話會發現在執行過程中 log file 都不會有輸出，要等到執行結束或緩衝滿了才會被輸出到 log file，這樣對於監控程式的執行很不方便。</p>
<h2 id="8-預載模型">8. 預載模型</h2>
<p>這是一個坑，感謝學長幫我解決這問題。說明文件中沒有提到但很重要的一點是<strong>運算節點沒有網路連線</strong>，因此需要網路的python指令無法執行，例如深度學習常用的下載 Pre-trained 模型
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">resnet34</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">resnet34</span><span class="p">(</span><span class="n">pretrained</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></span></span></code></pre></td></tr></table>
</div>
</div></p>
<p>這段程式就會執行失敗，因為在節點裡無法下載。解決方法是我們先在登入節點的終端機手動用 python下載想要的模型，等到送入運算節點時就會自動包含我們曾經下載過的 pre-trained 模型了。</p>
<p>手動執行以下程式碼：
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">torchvision</span> <span class="kn">import</span> <span class="n">models</span>
</span></span><span class="line"><span class="cl"><span class="n">resnet34</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">resnet34</span><span class="p">(</span><span class="n">pretrained</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1">#換成你要用的模型 ResNet, VGG, etc...</span></span></span></code></pre></td></tr></table>
</div>
</div></p>
<h2 id="9-其他指令">9. 其他指令</h2>
<p>其他有一些實用的指令</p>
<h4 id="1-查詢剩餘空間額度">1. 查詢剩餘空間額度</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">/usr/lpp/mmfs/bin/mmlsquota -u <span class="nv">$USER_ID</span> --block-size auto fs01 fs02</span></span></code></pre></td></tr></table>
</div>
</div>
<ul>
<li>fs01: /work</li>
<li>fs02: /home</li>
</ul>
<h4 id="2-查詢工作記憶體使用狀況">2. 查詢工作記憶體使用狀況</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sacct -j <span class="nv">$jobid</span> -o JobID,JobName,Partition,User,NCPUS,AllocNodes,maxrss,Start,End,Elapsed,State</span></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="參考資料">參考資料</h2>
<ul>
<li><a href="https://man.twcc.ai/@Ldk_QYrOR2yo3m8Cb1549A/">https://man.twcc.ai/@Ldk_QYrOR2yo3m8Cb1549A/</a></li>
<li><a href="https://zh.wikipedia.org/zh-tw/Slurm%E5%B7%A5%E4%BD%9C%E8%B0%83%E5%BA%A6%E5%B7%A5%E5%85%B7">https://zh.wikipedia.org/zh-tw/Slurm%E5%B7%A5%E4%BD%9C%E8%B0%83%E5%BA%A6%E5%B7%A5%E5%85%B7</a></li>
<li><a href="https://pytorch.org/get-started/previous-versions/">https://pytorch.org/get-started/previous-versions/</a></li>
</ul>

    </div>

    
    
<div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content"><a href="https://oxygentw.net/author/oxygen/">oxygen</a></span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
      2025-07-11
      
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">授權條款</span>
    <span class="item-content">Copyright © 2017-2025 oxygen. All rights reserved.</span>
  </p>
</div>


    
    

    <footer class="post-footer">
      

      
      <nav class="post-nav">
        
          <a class="prev" href="/blog/travel/visit-urgent-care-in-us/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">在美國生病怎麼辦 | 美國 Urgent Care 經驗分享</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        
          <a class="next" href="/blog/computer/mac-shortcut-control-openwrt-vpn/">
            <span class="next-text nav-default">利用 MacOS 捷徑 app 控制 OpenWRT OpenVPN</span>
            <span class="prev-text nav-mobile">下一篇</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  
  
  

  
  

  

  
  

  

  

  <div class="disqus-comment">
  <div class="disqus-button" id="load_disqus" onclick="load_disqus()">
    顯示 Disqus 評論
  </div>
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_config = function () {
      this.page.url = "https://oxygentw.net/blog/computer/nchc-taiwania-iii-note/";
    };
    function load_disqus() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'oxygentw';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);

      $('#load_disqus').remove();
    };
  </script>
  <noscript>Please enable JavaScript to view the
    <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
  </noscript>
  
  </div>

    

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="mailto:oxygen5307@gmail.com" rel="me noopener" class="iconfont"
      title="email" >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>
  
    <a href="https://github.com/oxygen-TW" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>
  
    <a href="https://www.instagram.com/mt.creamer/" rel="me noopener" class="iconfont"
      title="instagram"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M853.333333 277.333333C853.333333 289.28 843.946667 298.666667 832 298.666667L746.666667 298.666667C734.72 298.666667 725.333333 289.28 725.333333 277.333333L725.333333 192C725.333333 180.053333 734.72 170.666667 746.666667 170.666667L832 170.666667C843.946667 170.666667 853.333333 180.053333 853.333333 192M192 853.333333C180.053333 853.333333 170.666667 843.946667 170.666667 832L170.666667 469.333333 259.84 469.333333C257.28 482.986667 256 497.493333 256 512 256 653.226667 370.773333 768 512 768 653.226667 768 768 653.226667 768 512 768 497.493333 766.293333 482.986667 764.16 469.333333L853.333333 469.333333 853.333333 832C853.333333 843.946667 843.946667 853.333333 832 853.333333M512 341.333333C606.293333 341.333333 682.666667 417.706667 682.666667 512 682.666667 606.293333 606.293333 682.666667 512 682.666667 417.706667 682.666667 341.333333 606.293333 341.333333 512 341.333333 417.706667 417.706667 341.333333 512 341.333333M853.333333 85.333333 170.666667 85.333333C123.306667 85.333333 85.333333 123.306667 85.333333 170.666667L85.333333 853.333333C85.333333 900.266667 123.733333 938.666667 170.666667 938.666667L853.333333 938.666667C900.266667 938.666667 938.666667 900.266667 938.666667 853.333333L938.666667 170.666667C938.666667 123.306667 900.266667 85.333333 853.333333 85.333333Z"></path>
</svg>

    </a>


<a href="https://oxygentw.net/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2017 -
    2025
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        oxygen
        
      </span></span>

  
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.dee43230127a73d039a734510fa896c89c3c7ce0cf0be0c7a7433f8fd69b76dc.js" integrity="" crossorigin="anonymous"></script>



  <script type="text/javascript">
    window.MathJax = {
      showProcessingMessages: false,
      messageStyle: 'none'
    };
  </script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML' async></script>









  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  









  <script id="dsq-count-scr" src="//oxygentw.disqus.com/count.js" async></script>







</body>
</html>
